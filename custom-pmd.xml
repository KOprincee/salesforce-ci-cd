<?xml version="1.0"?>
<ruleset name="Custom Rules"
    xmlns="http://pmd.sourceforge.net/ruleset/2.0.0"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://pmd.sourceforge.net/ruleset/2.0.0 https://pmd.sourceforge.io/ruleset_2_0_0.xsd">
    
    <description>
        My custom rules
    </description>
    <!-- Your rules will come here -->
    <!-- IGNORE EXTERNAL LIBS -->
    <include-pattern>.*/force-app/main/default/.*</include-pattern>


    <!-- STANDARD RULES -->  
    
    <rule ref="category/apex/security.xml">
        <priority>1</priority>
    </rule>  

    <rule ref="category/apex/bestpractices.xml">      
        <priority>2</priority>   
        
        <exclude name="ApexUnitTestClassShouldHaveRunAs" /> <!-- No smart person does that -->
        <exclude name="ApexAssertionsShouldIncludeMessage" /> <!-- Better have a focused well named method -->
        <exclude name="ApexUnitTestClassShouldHaveAsserts" /> <!-- Configured below -->
    </rule>

    <rule ref="category/apex/bestpractices.xml/ApexUnitTestClassShouldHaveAsserts" message="Apex unit test classes should have at least one System.assert() or assertEquals() or AssertNotEquals() call">
        <priority>3</priority>
        <properties>
            <property name="additionalAssertMethodPattern" value="((System\.Assert|Assert|Asserts)\.\w+|verify\w+)"/>
        </properties>
    </rule>
    
    <rule ref="category/apex/design.xml">      
        <priority>2</priority>  

        <!-- Note: Cognitive Complexity covers all of that better -->     
        <exclude name="AvoidDeeplyNestedIfStmts" />
        <exclude name="StdCyclomaticComplexity" />
        <exclude name="CyclomaticComplexity" />
        <exclude name="ExcessiveClassLength" />
        <exclude name="ExcessiveParameterList" />
        <exclude name="ExcessivePublicCount" />
        <exclude name="TooManyFields" />
        <exclude name="NcssConstructorCount" />
        <exclude name="NcssMethodCount" />
        <exclude name="NcssTypeCount" />
    </rule>

    <rule ref="category/apex/performance.xml">      
        <priority>2</priority>   

        <!-- Improved by AvoidProductionDebugLogs below -->
        <exclude name="AvoidDebugStatements" />   
    </rule>

    <rule name="AvoidDebugStatements" language="apex" message="Avoid leaving System.debug() statments in code as they negativly influence performance." class="net.sourceforge.pmd.lang.rule.xpath.XPathRule">
        <priority>2</priority>   
        <properties>
            <property name="xpath"><value><![CDATA[
                //MethodCallExpression[lower-case(@FullMethodName)='system.debug'][count(*)=2]
            ]]></value></property>
        </properties>
    </rule>

    <rule ref="category/apex/codestyle.xml">      
        <priority>2</priority>  
        
        <!-- Improve by disallowing _ in Classnames -->
        <exclude name="ClassNamingConventions" />  
    </rule>

    <rule ref="category/apex/codestyle.xml/ClassNamingConventions">
        <priority>2</priority> 
        <properties>
            <property name="testClassPattern" value="[A-Z][a-zA-Z0-9_]*" />
            <property name="abstractClassPattern" value="[A-Z][a-zA-Z0-9]*" />
            <property name="classPattern" value="[A-Z][a-zA-Z0-9]*" />
            <property name="interfacePattern" value="[A-Z][a-zA-Z0-9]*" />
            <property name="enumPattern" value="[A-Z][a-zA-Z0-9]*" />
        </properties>
    </rule>  

    <rule ref="category/apex/errorprone.xml">      
        <priority>2</priority>  
        <!-- Note: Stupid category but I think everything in there is valid and a 2 -->     
    </rule>
</ruleset>
